{"version":3,"sources":["webpack:///./src/containers/Home/Home.js","webpack:///./src/services/Property.js","webpack:///./src/containers/Home/Home.scss","webpack:///./src/containers/Home/Home.scss?7fee","webpack:///./src/config/index.js","webpack:///./src/adapters/HttpClient.js","webpack:///./src/services/PropertyTransformer.js"],"names":["_react","__webpack_require__","_reactRouterDom","_components","_PropertyTransformer","_Property","PropertyTransformerFactory","args","PropertyTransformer","getProperties","sortPropertiesFactory","properties","sort","PropertyService","sortProperties","Home","props","_classCallCheck","this","_this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","call","state","city","filters","type","Component","_this2","history","push","unlisten","listen","location","hash","slice","setState","_extends","getPropertiesByCity","_this3","then","updateProperties","catch","error","logError","evt","key","updateFromSortFilter","value","updateFromTypeFilter","_ref","_this4","_ref2","_this5","err","console","log","downloadPayload","_this6","_react2","default","createElement","Fragment","Header","className","styles","wrapper","filterContainer","Filters","onChange","onSubmit","propertyListContainer","PropertyList","withRouter","_HttpClient","_config","httpClient","HttpClient","BASE_URL","typeParam","undefined","get","ids","newIds","join","by","a","b","pricePerMonth","payload","dataStr","encodeURIComponent","JSON","stringify","downloadAnchorNode","document","setAttribute","Date","toISOString","body","appendChild","click","remove","exports","module","i","locals","content","options","hmr","transform","insertInto","URL","axios","data","post","propertyService","_ref$limit","limit","Promise","resolve","reject","_getPropertiesIds","_getProperties","getPropertiesId","_ref3","map","property","id","_ref4","homecards"],"mappings":"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","file":"js/2.a1ecd8e5b4cacb712781.js","sourcesContent":["// @flow\nimport React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport { Header, Filters, PropertyList } from 'components';\nimport { PropertyTransformer } from './../../services/PropertyTransformer';\nimport { type Property } from './../../types/property';\nimport {\n  type OnChangeEvent,\n  type FiltersState\n} from './../../components/Filters/Filters';\nimport { PropertyService } from '../../services/Property';\nimport styles from './Home.scss';\n\ntype Props = {\n  history: {\n    push: Function,\n    listen: Function\n  }\n};\n\ntype State = {\n  city: string,\n  properties: Property[],\n  filters: {\n    sort: string,\n    type: string\n  }\n};\n\nconst PropertyTransformerFactory = args => {\n  return new PropertyTransformer().getProperties(args);\n};\n\nconst sortPropertiesFactory = (properties: Property[], sort: string) => {\n  return new PropertyService().sortProperties(properties, sort);\n};\n\nclass Home extends Component<Props, State> {\n  unlisten: Function;\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      city: 'madrid',\n      properties: [],\n      filters: {\n        sort: 'ascending',\n        type: 'all'\n      }\n    };\n  }\n\n  componentDidMount() {\n    this.props.history.push(`#${this.state.city}`);\n    this.unlisten = this.props.history.listen(location => {\n      const city = location.hash.slice(1);\n      this.setState(state => ({\n        ...state,\n        city: city\n      }));\n      this.getPropertiesByCity(city);\n    });\n    this.getPropertiesByCity(this.state.city);\n  }\n\n  componentWillUnmount() {\n    this.unlisten();\n  }\n\n  getPropertiesByCity(city: string) {\n    PropertyTransformerFactory({\n      city: city,\n      type: this.state.filters.type\n    })\n      .then(properties => this.updateProperties(properties))\n      .catch(error => this.logError(error));\n  }\n\n  onChange(evt: OnChangeEvent) {\n    const SORT = 'sort';\n    const TYPE = 'type';\n\n    if (evt.key === SORT) {\n      this.updateFromSortFilter({\n        properties: this.state.properties,\n        sort: evt.value\n      });\n    }\n\n    if (evt.key === TYPE) {\n      this.updateFromTypeFilter({\n        city: this.state.city,\n        type: evt.value\n      });\n    }\n  }\n\n  updateFromSortFilter({ properties, sort }) {\n    this.setState(state => ({\n      ...state,\n      properties: sortPropertiesFactory(properties, sort),\n      filters: {\n        ...state.filters,\n        sort: sort\n      }\n    }));\n  }\n\n  updateFromTypeFilter({ city, type }) {\n    this.setState(state => ({\n      ...state,\n      filters: {\n        ...state.filters,\n        type: type\n      }\n    }));\n    PropertyTransformerFactory({\n      city: city,\n      type: type\n    })\n      .then(properties => this.updateProperties(properties))\n      .catch(error => this.logError(error));\n  }\n\n  updateProperties(properties: Property[]) {\n    this.setState(state => ({\n      ...state,\n      properties: sortPropertiesFactory(properties, this.state.filters.sort)\n    }));\n  }\n\n  logError(err) {\n    console.log('err updating properties', err);\n  }\n\n  onSubmit(evt: FiltersState) {\n    new PropertyService().downloadPayload({\n      filters: evt,\n      properties: this.state.properties\n    });\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n        <Header />\n        <div className={styles.wrapper}>\n          <div className={styles.filterContainer}>\n            <Filters\n              filters={this.state.filters}\n              onChange={evt => this.onChange(evt)}\n              onSubmit={evt => this.onSubmit(evt)}\n            />\n          </div>\n          <div className={styles.propertyListContainer}>\n            <PropertyList properties={this.state.properties} />\n          </div>\n        </div>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default withRouter(Home);\n","// @flow\nimport { HttpClient } from 'adapters/HttpClient';\nimport { BASE_URL } from 'config';\nimport { type AxiosPromise } from 'axios';\nimport { type Property } from './../types/property';\n\ntype Response<T> = {\n  ok: boolean,\n  data: T\n};\n\ntype PropertyId = {\n  id: number\n};\n\nexport class PropertyService {\n  httpClient: HttpClient;\n  endpoint: string;\n  constructor() {\n    this.httpClient = new HttpClient(BASE_URL);\n  }\n\n  getPropertiesId({\n    city,\n    type\n  }: {\n    city: string,\n    type: string | typeof undefined\n  }): AxiosPromise<Response<PropertyId>> {\n    const typeParam = type === undefined ? '' : `?type=${type}`;\n    return this.httpClient.get(`/properties-by-id/${city}${typeParam}`);\n  }\n\n  getProperties(ids: number[]): AxiosPromise<Response<Property[]>> {\n    const newIds = ids.join(',');\n    return this.httpClient.get(`/properties?ids=${newIds}`);\n  }\n\n  sortProperties(properties: Property[], by: string): Property[] {\n    return properties.sort((a, b) => {\n      return by === 'descending'\n        ? b.pricePerMonth - a.pricePerMonth\n        : a.pricePerMonth - b.pricePerMonth;\n    });\n  }\n\n  downloadPayload(payload: any) {\n    /* eslint-disable */\n    const dataStr =\n      'data:text/json;charset=utf-8,' +\n      encodeURIComponent(JSON.stringify(payload, null, 4));\n    const downloadAnchorNode = document.createElement('a');\n    downloadAnchorNode.setAttribute('href', dataStr);\n    downloadAnchorNode.setAttribute(\n      'download',\n      new Date().toISOString() + '.json'\n    );\n    /* eslint-enable */\n    (document: any).body.appendChild(downloadAnchorNode);\n    downloadAnchorNode.click();\n    downloadAnchorNode.remove();\n  }\n}\n","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"._1MPLaI-JIxbYqrLMCnVqJy{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:1em}@media (min-width:37.5em){._1MPLaI-JIxbYqrLMCnVqJy{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}}._1W0-CZwN6_Vgbrd0Mkf_bS{width:100%}@media (min-width:37.5em){._1W0-CZwN6_Vgbrd0Mkf_bS{padding-right:1em;width:calc(33.33% - 1em)}}._1Z-oi69UAMV5ZYGbEucgMT{width:100%}@media (min-width:37.5em){._1Z-oi69UAMV5ZYGbEucgMT{width:calc(66.66% - 1em)}}\", \"\"]);\n\n// exports\nexports.locals = {\n\t\"wrapper\": \"_1MPLaI-JIxbYqrLMCnVqJy\",\n\t\"filterContainer\": \"_1W0-CZwN6_Vgbrd0Mkf_bS\",\n\t\"propertyListContainer\": \"_1Z-oi69UAMV5ZYGbEucgMT\"\n};","\nvar content = require(\"!!../../../node_modules/css-loader/index.js??ref--5-1!../../../node_modules/postcss-loader/lib/index.js!../../../node_modules/sass-loader/lib/loader.js!./Home.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js??ref--5-1!../../../node_modules/postcss-loader/lib/index.js!../../../node_modules/sass-loader/lib/loader.js!./Home.scss\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js??ref--5-1!../../../node_modules/postcss-loader/lib/index.js!../../../node_modules/sass-loader/lib/loader.js!./Home.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","// @flow\nexport const BASE_URL = process.env.NODE_ENV === 'development' ? 'http://localhost:4000' : '';\n\n","// @flow\nimport axios from 'axios';\n\nexport class HttpClient {\n  BASE_URL: string;\n  constructor(BASE_URL: string) {\n    this.BASE_URL = BASE_URL;\n  }\n\n  async get(URL: string) {\n    return axios.get(this.BASE_URL + URL);\n  }\n\n  async post<T>(URL: string, data: T) {\n    return axios.post(this.BASE_URL + URL, data);\n  }\n}","// @flow\n\nimport { PropertyService } from './Property';\nimport { type Property } from './../types/property';\n\nexport class PropertyTransformer {\n  propertyService: PropertyService;\n\n  constructor() {\n    this.propertyService = new PropertyService();\n  }\n\n  getProperties({\n    city,\n    type,\n    limit = 30\n  }: {\n    city: string,\n    type?: string,\n    limit?: number\n  }): Promise<Property[]> {\n    return new Promise((resolve, reject) => {\n      this._getPropertiesIds({\n        city: city,\n        type: type,\n        limit: limit\n      })\n        .then(ids => {\n          this._getProperties(ids)\n            .then(properties => resolve(properties))\n            .catch(err => reject(err));\n        })\n        .catch(err => reject(err));\n    });\n  }\n\n  _getPropertiesIds({\n    city,\n    type,\n    limit\n  }: {\n    city: string,\n    type?: string,\n    limit: number\n  }): Promise<number[]> {\n    const from = 0;\n    return this.propertyService\n      .getPropertiesId({ city: city, type: type })\n      .then(({ data: { data: ids } }) => {\n        return ids.slice(from, limit).map(property => property.id);\n      })\n      .catch(err => err);\n  }\n\n  _getProperties(ids: number[]): Promise<Property[]> {\n    return this.propertyService\n      .getProperties(ids)\n      .then(\n        ({\n          data: {\n            data: { homecards: properties }\n          }\n        }) => properties\n      )\n      .catch(err => err);\n  }\n}\n"],"sourceRoot":""}