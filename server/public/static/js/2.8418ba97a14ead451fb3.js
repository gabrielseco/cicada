(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{430:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(2),a=f(o),u=r(58),c=r(54),s=r(437);r(103),r(150);var l=r(432),p=f(r(434));function f(e){return e&&e.__esModule?e:{default:e}}var y=function(e,t){return(new l.PropertyService).sortProperties(e,t)},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={city:"madrid",properties:[],filters:{sort:"ascending",type:"all"}},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),i(t,[{key:"componentDidMount",value:function(){var e=this;this.props.history.push("#"+this.state.city),this.unlisten=this.props.history.listen(function(t){var r=t.hash.slice(1);e.setState(function(e){return n({},e,{city:r})}),e.getProperties({city:r,type:e.state.filters.type})}),this.getProperties({city:this.state.city,type:this.state.filters.type})}},{key:"componentWillUnmount",value:function(){this.unlisten()}},{key:"getProperties",value:function(e){var t=this;(function(e){return(new s.PropertyTransformer).getProperties(e)})({city:e.city,type:e.type}).then(function(e){return t.updateProperties(e)}).catch(function(e){return t.logError(e)})}},{key:"onChange",value:function(e){"sort"===e.key&&this.updateFromSortFilter({properties:this.state.properties,sort:e.value}),"type"===e.key&&this.updateFromTypeFilter({city:this.state.city,type:e.value})}},{key:"updateFromSortFilter",value:function(e){var t=e.properties,r=e.sort;this.setState(function(e){return n({},e,{properties:y(t,r),filters:n({},e.filters,{sort:r})})})}},{key:"updateFromTypeFilter",value:function(e){var t=e.city,r=e.type;this.setState(function(e){return n({},e,{filters:n({},e.filters,{type:r})})}),this.getProperties({city:t,type:r})}},{key:"updateProperties",value:function(e){var t=this;this.setState(function(r){return n({},r,{properties:y(e,t.state.filters.sort)})})}},{key:"logError",value:function(e){console.log("err updating properties",e)}},{key:"onSubmit",value:function(e){(new l.PropertyService).downloadPayload({filters:e,properties:this.state.properties})}},{key:"render",value:function(){var e=this;return a.default.createElement(a.default.Fragment,null,a.default.createElement(c.Header,null),a.default.createElement("div",{className:p.default.wrapper},a.default.createElement("div",{className:p.default.filterContainer},a.default.createElement(c.Filters,{isLoading:0===this.state.properties.length,filters:this.state.filters,onChange:function(t){return e.onChange(t)},onSubmit:function(t){return e.onSubmit(t)}})),a.default.createElement("div",{className:p.default.propertyListContainer},a.default.createElement(c.PropertyList,{properties:this.state.properties}))))}}]),t}();t.default=(0,u.withRouter)(d)},432:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PropertyService=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(436),o=r(435);r(429),r(103);t.PropertyService=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.httpClient=new i.HttpClient(o.BASE_URL)}return n(e,[{key:"getPropertiesId",value:function(e){var t=e.city,r=e.type,n=void 0===r?"":"?type="+r;return this.httpClient.get("/properties-by-id/"+t+n)}},{key:"getProperties",value:function(e){var t=e.join(",");return this.httpClient.get("/properties?ids="+t)}},{key:"sortProperties",value:function(e,t){return e.sort(function(e,r){return"descending"===t?r.pricePerMonth-e.pricePerMonth:e.pricePerMonth-r.pricePerMonth})}},{key:"downloadPayload",value:function(e){var t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,4)),r=document.createElement("a");r.setAttribute("href",t),r.setAttribute("download",(new Date).toISOString()+".json"),document.body.appendChild(r),r.click(),r.remove()}}]),e}()},433:function(e,t,r){(t=e.exports=r(29)(!1)).push([e.i,"._1MPLaI-JIxbYqrLMCnVqJy{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:1em}@media (min-width:37.5em){._1MPLaI-JIxbYqrLMCnVqJy{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}}._1W0-CZwN6_Vgbrd0Mkf_bS{width:100%}@media (min-width:37.5em){._1W0-CZwN6_Vgbrd0Mkf_bS{padding-right:1em;width:calc(33.33% - 1em)}}._1Z-oi69UAMV5ZYGbEucgMT{width:100%}@media (min-width:37.5em){._1Z-oi69UAMV5ZYGbEucgMT{width:calc(66.66% - 1em)}}",""]),t.locals={wrapper:"_1MPLaI-JIxbYqrLMCnVqJy",filterContainer:"_1W0-CZwN6_Vgbrd0Mkf_bS",propertyListContainer:"_1Z-oi69UAMV5ZYGbEucgMT"}},434:function(e,t,r){var n=r(433);"string"==typeof n&&(n=[[e.i,n,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};r(28)(n,i);n.locals&&(e.exports=n.locals)},435:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BASE_URL=""},436:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpClient=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(429));t.HttpClient=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.BASE_URL=t}return n(e,[{key:"get",value:async function(e){return i.default.get(this.BASE_URL+e)}},{key:"post",value:async function(e,t){return i.default.post(this.BASE_URL+e,t)}}]),e}()},437:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PropertyTransformer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(432);r(103);t.PropertyTransformer=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.propertyService=new i.PropertyService}return n(e,[{key:"getProperties",value:function(e){var t=this,r=e.city,n=e.type,i=e.limit,o=void 0===i?30:i;return new Promise(function(e,i){t._getPropertiesIds({city:r,type:n,limit:o}).then(function(r){t._getProperties(r).then(function(t){return e(t)}).catch(function(e){return i(e)})}).catch(function(e){return i(e)})})}},{key:"_getPropertiesIds",value:function(e){var t=e.city,r=e.type,n=e.limit;return this.propertyService.getPropertiesId({city:t,type:r}).then(function(e){return e.data.data.slice(0,n).map(function(e){return e.id})}).catch(function(e){return e})}},{key:"_getProperties",value:function(e){return this.propertyService.getProperties(e).then(function(e){return e.data.data.homecards}).catch(function(e){return e})}}]),e}()}}]);
//# sourceMappingURL=2.8418ba97a14ead451fb3.js.map